FROM openjdk:11.0.2-jre-slim-stretch AS builder

RUN mkdir /tmp/rsk
COPY ./rsk-private /tmp/rsk/.
WORKDIR /tmp/rsk
RUN ./gradlew build -x test

RUN mkdir /opt/pantheon
WORKDIR /tmp/rsk/build/distributions/
RUN tar xzf pantheon-*.tar.gz -C /tmp && \
  mv /tmp/pantheon-*/* /opt/pantheon

FROM openjdk:11.0.2-jre-slim-stretch
RUN mkdir /opt/pantheon && \
  mkdir /var/lib/pantheon && \
  mkdir /etc/pantheon/

COPY --from=builder /opt/pantheon /opt/pantheon
COPY entrypoint.sh /opt/pantheon/pantheon-entrypoint.sh

WORKDIR /opt/pantheon
RUN chmod +x /opt/pantheon/pantheon-entrypoint.sh

WORKDIR /var/lib/pantheon
VOLUME ["/var/lib/pantheon"]

EXPOSE 8545 8546 30303

ENV PANTHEON_OPTS="-Dpantheon.docker=true"

#ENTRYPOINT ["/opt/pantheon/pantheon-entrypoint.sh"]